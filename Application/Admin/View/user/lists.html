<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.2.0
Version: 3.2.0
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>用户管理</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta content="" name="description"/>
<meta content="" name="author"/>
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<link href="__PUBLIC__/Style/assets/global/fonts/2.css" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Style/assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Style/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Style/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Style/assets/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css">
<!-- END GLOBAL MANDATORY STYLES -->
<!-- BEGIN PAGE LEVEL STYLES -->
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Style/assets/global/plugins/select2/select2.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/Style/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css"/>
<!-- END PAGE LEVEL STYLES -->
<!-- BEGIN THEME STYLES -->
<link href="__PUBLIC__/Style/assets/global/css/components.css" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Style/assets/global/css/plugins.css" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Style/assets/admin/layout3/css/layout.css" rel="stylesheet" type="text/css">
<link href="__PUBLIC__/Style/assets/admin/layout3/css/themes/default.css" rel="stylesheet" type="text/css" id="style_color">
<link href="__PUBLIC__/Style/assets/admin/layout3/css/custom.css" rel="stylesheet" type="text/css">
<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<!-- DOC: Apply "page-header-menu-fixed" class to set the mega menu fixed  -->
<!-- DOC: Apply "page-header-top-fixed" class to set the top menu fixed  -->
<body>
<!-- BEGIN HEADER -->
<div class="page-header">
	<!-- BEGIN HEADER TOP -->
	<include file="./Application/Admin/View/Public/tpl/header.html" />
	<!-- END HEADER TOP -->
	
	<!-- BEGIN HEADER MENU -->
	<include file="./Application/Admin/View/Public/tpl/nav.html" />
	<!-- END HEADER MENU -->
</div>
<!-- END HEADER -->
<!-- BEGIN PAGE CONTAINER -->
<div class="page-container">
	<!-- BEGIN PAGE HEAD -->
	<div class="page-head">
		<div class="container">
			<!-- BEGIN PAGE TITLE -->
			<div class="page-title">
				<h1>用户 <small>用户列表</small></h1>
			</div>
			<!-- END PAGE TITLE -->
			<!-- BEGIN PAGE TOOLBAR -->
			<include file="./Application/Admin/View/Public/tpl/settings.html" />
			<!-- END PAGE TOOLBAR -->
		</div>
	</div>
	<!-- END PAGE HEAD -->
	<!-- BEGIN PAGE CONTENT -->
	<div class="page-content">
		<div class="container">
		
			<form class="form-horizontal" role="form" action="__MODULE__/user/add" method="post">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<div class="modal fade" id="createUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
							<h4 class="modal-title bold green">新建用户</h4>
						</div>
						<div class="modal-body form">
							 
							 	<div class="form-group">
										<label class="col-md-3 control-label">真实姓名</label>
										<div class="col-md-6">
											<input type="text" class="form-control" id="realname_add" name="realname" placeholder="真实姓名">
										</div>
								</div>
							 
								<div class="form-body">
									<div class="form-group">
										<label class="col-md-3 control-label">登录帐号</label>
										<div class="col-md-6">
											<input type="text" class="form-control" id="userName_add" name="userName" placeholder="登录帐号">
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-md-3 control-label">登录密码</label>
										<div class="col-md-6">
											<input type="password" class="form-control" id="password_add" name="password" placeholder="登录密码">
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-md-3 control-label">确认密码</label>
										<div class="col-md-6">
											<input type="password" class="form-control" id="rpassword_add" name="rpassword" placeholder="确认密码">
										</div>
									</div>
									
									
									<div class="form-group">
										<label class="col-md-3 control-label">联系电话</label>
										<div class="col-md-6">
											<input type="text" class="form-control" id="phone_add" name="phone" placeholder="联系电话">
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-md-3 control-label">联系地址</label>
										<div class="col-md-6">
											<input type="text" class="form-control" id="address_add" name="address" placeholder="联系地址">
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-md-3 control-label">允许登录</label>
										<div class="col-md-6">
											<div class="radio-list">
												<label class="radio-inline">
												<div class="radio"><span class="checked"><input type="radio" name="status" id="status_add" value="1" checked=""></span></div> 是</label>
												<label class="radio-inline">
												<div class="radio"><span><input type="radio" name="status" value="0"></span></div> 否 </label>
											</div>
										</div>
									</div>
									
								</div>
								
							
						</div>
						<div class="modal-footer">
							<button type="button" id="saveBtn" class="btn green">保存</button>
							<button type="button" class="btn default" data-dismiss="modal">关闭</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
			</form>
			<!-- /.modal -->
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			
			<form class="form-horizontal" role="form" method="post" action="__MODULE__/user/edit">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<div class="modal fade" id="editUser" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
							<h4 class="modal-title bold green">编辑用户</h4>
						</div>
						<div class="modal-body form">
							 
								<div class="form-body">
								
									<div class="form-group">
										<label class="col-md-3 control-label">真实姓名</label>
										<div class="col-md-6">
											<input type="text" class="form-control" id="realname_edit" name="realname" placeholder="真实姓名">
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-md-3 control-label">登录帐号</label>
										<div class="col-md-6">
											<input type="text" class="form-control" id="userName_edit" name="userName" placeholder="登录帐号">
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-md-3 control-label">登录密码</label>
										<div class="col-md-6">
											<input type="password" class="form-control" id="password_edit" name="password" placeholder="登录密码">
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-md-3 control-label">确认密码</label>
										<div class="col-md-6">
											<input type="password" class="form-control" id="rpassword_edit" name="rpassword" placeholder="确认密码">
										</div>
									</div>
									
									
									<div class="form-group">
										<label class="col-md-3 control-label">联系电话</label>
										<div class="col-md-6">
											<input type="text" class="form-control" id="phone_edit" name="phone" placeholder="联系电话">
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-md-3 control-label">联系地址</label>
										<div class="col-md-6">
											<input type="text" class="form-control" id="address_edit" name="address" placeholder="联系地址">
										</div>
									</div>
									
									
									<input type="hidden" class="form-control" id="id_edit" name="ID" placeholder="">
									
									<div class="form-group">
										<label class="col-md-3 control-label">允许登录</label>
										<div class="col-md-6">
											<div class="radio-list">
												<label class="radio-inline">
												<div class="radio"><span class="checked"><input type="radio" name="status" id="status_edit" value="1" checked=""></span></div> 是</label>
												<label class="radio-inline">
												<div class="radio"><span><input type="radio" name="status" id="status_edit_no" value="0"></span></div> 否 </label>
											</div>
										</div>
									</div>
									
								</div>
								
							
						</div>
						<div class="modal-footer">
							<button type="button" id="updateBtn" class="btn green">保存</button>
							<button type="button" class="btn default" data-dismiss="modal">关闭</button>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
				
			</form>
			<!-- /.modal -->
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			
			<!-- BEGIN PAGE CONTENT INNER -->
			
			<div class="row">
				<div class="col-md-12 col-sm-12">
					<!-- BEGIN EXAMPLE TABLE PORTLET-->
					<div class="portlet light">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-users font-green-sharp"></i>
								<span class="caption-subject font-green-sharp bold uppercase">用户列表</span>
							</div>
							
							<div class="tools">
								<a href="javascript:;" class="collapse">
								</a>
								<a href="javascript:;" class="reload">
								</a>
							</div>
							
							<div class="actions btn-set">
								<button onclick="$('#createUser').modal('show');" class="btn green-haze btn-circle"><i class="fa fa-plus"></i> 添加</button>
								<div class="btn-group">
									<a class="btn btn-circle btn-danger" href="#" id="deleteSelected" data-toggle="dropdown">
										<i class="fa  fa-trash-o"></i> 删除 </i>
									</a>
								</div>
							</div>
						</div>
						<div class="portlet-body">
							<table class="table table-striped table-bordered table-hover" id="sample_2">
							<thead>
							<tr>
								<th class="table-checkbox">
									<input type="checkbox" class="group-checkable" data-set="#sample_2 .checkboxes"/>
								</th>
								<th>编号</th>
								<th>
									真实姓名
								</th>
								<th>登录帐号</th>
								<th>
									联系电话
								</th>
								<th>地址</th>
								<th>
									 注册时间
								</th>
								<th>状态</th>
								<th>
									操作
								</th>
							</tr>
							</thead>
							<tbody>
							<volist name="list" id="vo">
							<tr class="odd gradeX">
								<td>
									<input type="checkbox" class="checkboxes" value="{$vo.ID}"/>
								</td>
								<td>{$vo.ID}</td>
								<td>
									{$vo.realname}
								</td>
								<td>
									{$vo.userName}
								</td>
								<td>
									{$vo.phone}
								</td>
								<td>{$vo.address}</td>
								<td>
									{$vo.registerTime}
								</td>
								<td>
									<eq name="vo.status" value="1">允许登录<else/>禁止登录</eq>
								</td>
								<td>
									<a href="#editUser" data-toggle="modal" id="editUserBtn_{$vo.ID}" dataid="{$vo.ID}">编辑</a>
									<a href="javascript:void(0);" id="deleteUserBtn_{$vo.ID}" dataid="{$vo.ID}">删除</a>
								</td>
							</tr>
							</volist>
							</tbody>
							</table>
						</div>
					</div>
					<!-- END EXAMPLE TABLE PORTLET-->
				</div>
			</div>
			<!-- END PAGE CONTENT INNER -->
		</div>
	</div>
	<!-- END PAGE CONTENT -->
</div>
<!-- END PAGE CONTAINER -->
<!-- BEGIN FOOTER -->
<include file="./Application/Admin/View/Public/tpl/footer.html" />
<!-- END FOOTER -->
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="__PUBLIC__/Style/assets/global/plugins/respond.min.js"></script>
<script src="__PUBLIC__/Style/assets/global/plugins/excanvas.min.js"></script> 
<![endif]-->
<script src="__PUBLIC__/Style/assets/global/plugins/jquery-1.11.0.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/global/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="__PUBLIC__/Style/assets/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script type="text/javascript" src="__PUBLIC__/Style/assets/global/plugins/select2/select2.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/Style/assets/global/plugins/datatables/media/js/jquery.dataTables.js"></script>
<script type="text/javascript" src="__PUBLIC__/Style/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="__PUBLIC__/Style/assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/admin/layout3/scripts/layout.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/admin/layout3/scripts/demo.js" type="text/javascript"></script>
<script src="__PUBLIC__/Style/assets/admin/pages/scripts/table-managed.js"></script>
<script>
jQuery(document).ready(function() {       
   Metronic.init(); // init metronic core components
Layout.init(); // init current layout
Demo.init(); // init demo features
   TableManaged.init();
   
   
   $("a[id^=editUserBtn_]").on("click",function(event){
	  
	   var postData = {'ID':$(this).attr('dataid')};
	   $.ajax({
		   type: "POST",
		   url: "/index.php/admin/user/item",
		   data: postData,
		   success: function(obj){
			   $("#id_edit").val(obj.ID);
			   $("#userName_edit").val(obj.userName);
	   		   $("#realname_edit").val(obj.realname);
	   		   $("#phone_edit").val(obj.phone);
	   		   $("#address_edit").val(obj.address);
	   		   $("#password_edit").val('********');
	   		   $("#rpassword_edit").val('********');
	   		   if(obj.status==1){
	   				$("#status_edit").attr('checked',true);
	   				$("#status_edit").parent().addClass('checked');
	   				$("#status_edit_no").attr('checked',false);
	   				$("#status_edit_no").parent().removeClass('checked');
	   		   }else{
	   				$("#status_edit").attr('checked',false);
	   				$("#status_edit").parent().removeClass('checked');
   					$("#status_edit_no").attr('checked',true);
   					$("#status_edit_no").parent().addClass('checked');
	   		   }
	   		   
			   if(typeof obj != 'object'){
				   alert('网络异常，请稍后重试！');
			   }
		   }
		});
   });
   
   
   $("a[id^=deleteUserBtn_],#deleteSelected").on("click",function(event){
	   
	   if(this.id == 'deleteSelected'){
		 
		   var idArray = [];
		   $(".checked > input[type=checkbox]").each(function(i){
			   if(this.value != "on"){
				idArray.push(this.value);			   
			   }
		   });
		   var postData = {'ID' : idArray.toString()} 
		   if (idArray.length == 0){
			   alert('请选择要删除的用户');
			   return;
		   }
	   }else{
		   var postData = {'ID':$(this).attr('dataid')};
	   }
	   
	   if(!confirm("确定要删除用户？")){
		   return ;
	   }
	   $.ajax({
		   type: "POST",
		   async : false,
		   url: "/index.php/admin/user/delete",
		   data: postData,
		   success: function(rs){
			   if(parseInt(rs) > 0){
			   	   window.location.reload();
			   }else{
				   alert('网络异常，请稍后重试！');
			   }
		   }
		});
   });
   
   $("#saveBtn,#updateBtn").on("click",function(){
	   
	   var oper = (this.id == 'updateBtn') ? 'edit' : 'add';
	   
	   var postData = {
			   		    'userName':$("#userName_"+oper).val(),
			   			'realname':$("#realname_"+oper).val(),
			   			'phone':$("#phone_"+oper).val(),
			   			'address':$("#address_"+oper).val(),
			   			'password':$("#password_"+oper).val(),
			   			'rpassword':$("#rpassword_"+oper).val(),
			   			'status': $("#status_"+oper).attr('checked') ? 1 : 0
			   		  }
	   if(oper == 'edit'){
		   if($("#password_"+oper).val() == '********'){
			   delete postData.password;
			   delete postData.rpassword;
		   }
		   postData.ID = $("#id_edit").val();
	   }
	   //console.log(postData);return;
	   $.ajax({
		   type: "POST",
		   url: "/index.php/admin/user/"+oper,
		   data: postData,
		   success: function(msg){
			   if( parseInt(msg) > 0 ){
				  window.location.reload();
			   }else{
				   alert(msg);
			   }
		   }
		});
   });
   
});
</script>
</body>
<!-- END BODY -->
</html>